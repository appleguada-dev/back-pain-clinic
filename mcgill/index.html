<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BodyArchitect | ุงููุฎุชุจุฑ ุงูุชุดุฎูุตู ุงูุดุงูู</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body { font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #059669; border-radius: 4px; }

        /* Animation */
        @keyframes float {
            0% { transform: translateY(0px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
            50% { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2); }
            100% { transform: translateY(0px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        }
        .float-anim { animation: float 3s ease-in-out infinite; }

        /* Mobile specific adjustments */
        @media (max-width: 768px) {
            .float-anim { animation: none; } /* Disable float on mobile to save battery/distraction */
        }

        /* Print Styles */
        @media print {
            body, html, #app, main, .flex-1 {
                height: auto !important;
                min-height: 100% !important;
                overflow: visible !important;
                position: static !important;
                display: block !important;
            }
            aside, header, .no-print, button, .buttons-container, .guide-btn, .mobile-toggle { display: none !important; }
            .printable-area, .printable-area * { visibility: visible !important; }
            .printable-area {
                position: relative !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                background: white !important;
            }
            ul li, .card-break { page-break-inside: avoid; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 h-screen overflow-hidden selection:bg-emerald-200">

<div id="app" class="h-full flex flex-col md:flex-row">

    <aside class="w-full md:w-80 bg-gradient-to-b from-slate-900 to-slate-800 text-white flex flex-col shadow-2xl z-20 shrink-0 md:h-full transition-all duration-300 no-print" :class="mobileLogOpen ? 'h-1/2' : 'h-auto'">
        
        <div class="p-4 md:p-6 bg-emerald-600 shadow-lg relative overflow-hidden flex justify-between items-center md:block">
            <div class="absolute -top-10 -left-10 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
            <div class="relative z-10">
                <h1 class="text-xl md:text-2xl font-black flex items-center gap-2 md:gap-3">
                    <span class="text-2xl md:text-3xl">๐ฉบ</span> BodyArchitect
                </h1>
                <p class="text-emerald-100 text-[10px] md:text-xs mt-1 font-bold tracking-wider opacity-90 hidden md:block">ูุธุงู ุงูุชุดุฎูุต ุงููุชูุงูู</p>
            </div>
            
            <button @click="mobileLogOpen = !mobileLogOpen" class="md:hidden text-white bg-white/20 px-3 py-1 rounded-full text-xs font-bold border border-white/30">
                {{ mobileLogOpen ? 'ุฅุฎูุงุก ุงูุณุฌู' : 'ุงูุณุฌู ูุงูุชูุฏู โผ' }}
            </button>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-6 bg-slate-800 md:bg-transparent" :class="{'hidden md:block': !mobileLogOpen}">
            <div>
                <div class="flex justify-between text-xs text-slate-400 mb-2 font-bold">
                    <span>ุฑุญูุฉ ุงูุชุดุฎูุต</span>
                    <span>{{ Math.round(progress) }}%</span>
                </div>
                <div class="w-full bg-slate-700 h-3 rounded-full overflow-hidden shadow-inner">
                    <div class="bg-gradient-to-l from-emerald-400 to-emerald-600 h-full transition-all duration-1000 ease-out relative" :style="{ width: progress + '%' }"></div>
                </div>
            </div>

            <div>
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 border-b border-slate-700 pb-2 flex justify-between items-center">
                    <span>ุณุฌู ุงูุฃุฏูุฉ</span>
                    <span class="bg-slate-700 text-white text-[10px] px-2 py-0.5 rounded-full">{{ evidenceLog.length }}</span>
                </h3>
                
                <div v-if="evidenceLog.length === 0" class="text-sm text-slate-500 italic text-center py-6 border border-dashed border-slate-700 rounded-lg">
                    ูุชู ุชุฌููุน ุงูุฃุฏูุฉ...
                </div>
                
                <transition-group name="fade" tag="div" class="space-y-2">
                    <div v-for="(log, i) in evidenceLog" :key="i" class="bg-slate-700/50 border-r-4 border-emerald-500 p-3 rounded-lg text-sm hover:bg-slate-700 transition-colors cursor-default group">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-emerald-300 text-xs">{{ log.source }}</span>
                        </div>
                        <div class="font-bold text-white mb-1">{{ log.type }}</div>
                        <div class="text-xs text-slate-400 leading-snug">{{ log.note ? log.note.substring(0, 50) + '...' : '' }}</div>
                    </div>
                </transition-group>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-full relative overflow-hidden bg-slate-50">
        
        <header class="bg-white px-4 md:px-6 py-3 md:py-4 shadow-sm border-b flex justify-between items-center z-10 no-print shrink-0">
            <div>
                <h2 v-if="currentPhase === 'history'" class="text-base md:text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span class="bg-blue-100 text-blue-700 w-6 h-6 md:w-auto md:h-auto md:p-1.5 flex items-center justify-center rounded-lg text-xs md:text-sm">1</span>
                    <span class="truncate">ุชุญููู ุงูุชุงุฑูุฎ ุงูุทุจู</span>
                </h2>
                <h2 v-else-if="currentPhase === 'physical'" class="text-base md:text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span class="bg-emerald-100 text-emerald-700 w-6 h-6 md:w-auto md:h-auto md:p-1.5 flex items-center justify-center rounded-lg text-xs md:text-sm">2</span>
                    <span class="truncate">ุงูุงุฎุชุจุงุฑ {{ physicalIndex + 1 }} / {{ physicalTests.length }}</span>
                </h2>
                <h2 v-else-if="currentPhase === 'final'" class="text-base md:text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span class="bg-purple-100 text-purple-700 w-6 h-6 md:w-auto md:h-auto md:p-1.5 flex items-center justify-center rounded-lg text-xs md:text-sm">3</span>
                    <span>ุงูุชูุฑูุฑ</span>
                </h2>
                <h2 v-else class="text-lg md:text-xl font-bold text-slate-800">ูุฑุญุจุงู ุจู</h2>
            </div>
            <div class="text-[10px] md:text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 md:px-3 rounded-full whitespace-nowrap">Back Mechanic โข</div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-8 relative scroll-smooth" id="main-scroll">
            
            <div v-if="currentPhase === 'intro'" class="max-w-2xl mx-auto mt-4 md:mt-10 animate-fade-in-up pb-20">
                <div class="bg-white p-6 md:p-10 rounded-3xl shadow-2xl text-center border border-slate-100 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-emerald-400 to-blue-500"></div>
                    <div class="w-20 h-20 md:w-24 md:h-24 bg-emerald-50 rounded-full flex items-center justify-center text-4xl md:text-5xl mx-auto mb-4 md:mb-6 shadow-sm">๐ฉป</div>
                    <h2 class="text-2xl md:text-4xl font-black text-slate-800 mb-4 tracking-tight">ุงููุฎุชุจุฑ ุงูุชุดุฎูุตู</h2>
                    
                    <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 md:p-5 mb-6 md:mb-8 text-right shadow-sm">
                        <h4 class="text-amber-800 font-bold mb-2 flex items-center gap-2 text-sm md:text-base"><span>โ๏ธ</span> ุชูููู ุทุจู ูุงู</h4>
                        <p class="text-amber-700 text-xs md:text-sm leading-relaxed mb-4 font-medium">
                            ูุฐุง ุงูุชุทุจูู ุฃุฏุงุฉ ุชุนููููุฉ ูุฑูุน ุงููุนู ุงูุฌุณุฏู. ุงููุชุงุฆุฌ ููุณุช ุชุดุฎูุตุงู ุทุจูุงู ููุงุฆูุงู.
                        </p>
                        <label class="flex items-start gap-3 cursor-pointer group bg-white p-3 rounded-lg border border-amber-100 hover:border-amber-300 transition-colors">
                            <input type="checkbox" v-model="disclaimerAccepted" class="w-5 h-5 mt-0.5 accent-emerald-600 rounded border-gray-300 shrink-0">
                            <span class="text-xs md:text-sm font-bold text-slate-700">ูููุช ุฐููุ ูุฃูุงูู ุนูู ุงููุชุงุจุนุฉ.</span>
                        </label>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-right bg-slate-50 p-4 md:p-6 rounded-2xl border border-slate-200 mb-6 md:mb-8">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">ุงูุงุณู</label>
                            <input v-model="user.name" class="w-full bg-white border border-slate-300 rounded-lg p-3 outline-none focus:border-emerald-500 transition-colors">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 mb-1">ุงูุนูุฑ</label>
                            <input v-model.number="user.age" type="number" class="w-full bg-white border border-slate-300 rounded-lg p-3 outline-none focus:border-emerald-500 transition-colors">
                        </div>
                    </div>
                    <button @click="startApp" :disabled="!user.name || !disclaimerAccepted" class="w-full bg-emerald-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-emerald-700 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                        ุงุจุฏุฃ ุงูุชูููู ุงูุขู
                    </button>
                </div>
            </div>

            <div v-if="currentPhase === 'history'" class="max-w-3xl mx-auto pb-24">
                <div v-if="historyIndex === -1" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-6 animate-fade-in-up border-l-4 md:border-l-8 border-emerald-500">
                    <h3 class="text-xl md:text-2xl font-bold text-slate-800 mb-4">ุงูุฎุทูุฉ 1: ุงุตูุน ููุงุฆูู</h3>
                    <div class="text-slate-600 leading-relaxed space-y-4 mb-8 text-sm md:text-base font-medium">
                        <p>
                            ูุจู ุฃู ูุจุฏุฃุ ููุฑ ูู:
                            <br><strong>1. ุงูุฃูุดุทุฉ ุงูุชู ุชุฒูุฏ ุงูุฃูู.</strong>
                            <br><strong>2. ุงูุฃูุดุทุฉ ุงูุชู ุชุฑูุญู.</strong>
                        </p>
                        <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-xs md:text-sm">
                            <strong>ููุงุฐุงุ</strong> ูุฃู ููู ุงูููุท ูู ูุตู ุงูุนูุงุฌ. 
                        </div>
                    </div>
                    <button @click="historyIndex = 0" class="w-full bg-slate-800 text-white py-4 rounded-xl font-bold hover:bg-slate-900 transition-colors flex justify-center items-center gap-2 shadow-lg active:scale-95">
                        <span>ุฃูุง ุฌุงูุฒ</span>
                        <span>&larr;</span>
                    </button>
                </div>

                <div v-else class="transition-all duration-300">
                    <div v-if="!lastAnswerNote" class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-6 animate-fade-in-up">
                        <div class="mb-4 md:mb-6 flex justify-between items-center">
                            <span class="text-[10px] md:text-xs font-bold text-emerald-700 bg-emerald-100 px-3 py-1 rounded-full">ุณุคุงู {{ historyIndex + 1 }} / 10</span>
                        </div>
                        <h3 class="text-lg md:text-2xl font-bold mb-6 md:mb-8 text-slate-800 leading-snug">{{ currentHistoryQ.text }}</h3>
                        <div class="space-y-3 md:space-y-4">
                            <button v-for="opt in currentHistoryQ.options" @click="handleHistoryAnswer(opt)" class="w-full text-right p-4 md:p-5 rounded-xl border-2 border-slate-100 active:border-emerald-500 active:bg-emerald-50 hover:border-emerald-500 hover:bg-emerald-50 transition-all flex justify-between items-center group touch-manipulation">
                                <span class="font-bold text-slate-700 text-sm md:text-lg">{{ opt.label }}</span>
                                <div class="w-6 h-6 rounded-full border-2 border-slate-300 group-hover:border-emerald-500 group-hover:bg-emerald-500 flex items-center justify-center transition-colors shrink-0">
                                    <span class="text-white text-xs opacity-0 group-hover:opacity-100">โ</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div v-else class="bg-blue-50 border-r-4 md:border-r-8 border-blue-500 p-6 md:p-8 rounded-2xl shadow-lg mb-6 animate-fade-in-up">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl md:text-3xl bg-white p-2 rounded-full shadow-sm">๐ก</span>
                            <h4 class="font-bold text-blue-900 text-lg md:text-xl">ุงูุชุญููู ุงูููุฑู:</h4>
                        </div>
                        <p class="text-slate-800 text-base md:text-lg leading-7 md:leading-8 mb-8 font-medium text-justify">{{ lastAnswerNote }}</p>
                        <button @click="nextHistoryQuestion" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 shadow-lg transition-transform active:scale-95">
                            ุงูุณุคุงู ุงูุชุงูู &larr;
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="currentPhase === 'physical'" class="max-w-7xl mx-auto h-full flex flex-col lg:flex-row gap-6 md:gap-8 pb-24">
                <div class="w-full lg:w-1/2 flex flex-col gap-4 md:gap-6">
                    <div class="bg-white p-2 md:p-3 rounded-2xl shadow-xl border border-slate-200">
                        <div class="relative aspect-[4/3] bg-slate-100 rounded-xl overflow-hidden flex items-center justify-center group">
                            <img :src="currentPhysicalTest.image" :alt="currentPhysicalTest.title" class="w-full h-full object-contain p-2">
                            <div class="absolute top-2 left-2 md:top-4 md:left-4 bg-white/90 backdrop-blur text-slate-800 text-[10px] md:text-xs font-bold px-2 py-1 md:px-3 rounded-full shadow-sm">
                                ูุถุนูุฉ ุงูุงุฎุชุจุงุฑ
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 md:p-8 rounded-2xl shadow-md border-t-4 border-emerald-500 lg:flex-1 lg:overflow-y-auto">
                        <h3 class="text-emerald-800 font-bold mb-3 md:mb-4 flex items-center gap-2 text-base md:text-lg"><span>๐</span> ุงูุชุนูููุงุช:</h3>
                        <div class="text-slate-700 text-sm md:text-base leading-7 space-y-2 md:space-y-4 marker:text-emerald-500" v-html="currentPhysicalTest.instruction"></div>
                    </div>
                </div>

                <div class="w-full lg:w-1/2 flex flex-col justify-start lg:justify-center">
                    <transition name="fade" mode="out-in">
                        <div v-if="!currentTestResult" class="bg-white p-6 md:p-10 rounded-3xl shadow-2xl border border-slate-100">
                            <h3 class="text-xl md:text-2xl font-black text-slate-800 mb-6 md:mb-8 leading-snug">{{ currentPhysicalTest.question }}</h3>
                            <div class="space-y-3 md:space-y-4">
                                <button v-for="opt in currentPhysicalTest.options" @click="handlePhysicalAnswer(opt)" class="w-full text-right p-4 md:p-6 rounded-2xl border-2 border-slate-100 active:border-emerald-500 active:bg-emerald-50 hover:border-emerald-500 hover:bg-emerald-50 hover:shadow-lg transition-all flex justify-between items-center group touch-manipulation">
                                    <span class="font-bold text-slate-700 text-sm md:text-lg group-hover:text-emerald-800">{{ opt.label }}</span>
                                    <span class="text-xl md:text-2xl text-slate-300 group-hover:text-emerald-500 transition-colors">โ</span>
                                </button>
                            </div>
                        </div>

                        <div v-else class="bg-white rounded-3xl shadow-2xl border-2 border-emerald-100 overflow-hidden">
                            <div class="bg-emerald-50 p-6 md:p-8 border-b border-emerald-100">
                                <div class="flex items-center gap-3 mb-3">
                                    <span class="text-2xl md:text-3xl">๐</span>
                                    <h3 class="text-xl md:text-2xl font-bold text-emerald-900">ุงูุชุญููู:</h3>
                                </div>
                                <p class="text-slate-800 leading-7 md:leading-8 font-medium text-base md:text-lg mb-4 text-justify">{{ currentTestResult.feedback }}</p>
                                <div v-if="currentTestResult.diagnosis" class="inline-block bg-white text-emerald-700 px-3 py-1 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-bold shadow-sm border border-emerald-200">
                                    ุงููุคุดุฑ: {{ currentTestResult.diagnosis }}
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x md:divide-x-reverse divide-slate-100">
                                <div class="p-5 md:p-6 bg-green-50/50">
                                    <h4 class="text-green-700 font-black mb-3 md:mb-4 flex items-center gap-2 text-base md:text-lg"><span>โ</span> ุงูุนู</h4>
                                    <ul v-if="currentTestResult.dos.length > 0" class="text-sm text-slate-700 space-y-2 md:space-y-3 font-medium">
                                        <li v-for="tip in currentTestResult.dos" class="flex items-start gap-2"><span class="text-green-500 mt-1">โข</span> {{ tip }}</li>
                                    </ul>
                                    <p v-else class="text-xs text-slate-400 italic">ูุง ุชูุฌุฏ ุชูุตูุงุช ุฎุงุตุฉ.</p>
                                </div>
                                <div class="p-5 md:p-6 bg-red-50/50">
                                    <h4 class="text-red-700 font-black mb-3 md:mb-4 flex items-center gap-2 text-base md:text-lg"><span>โ</span> ุชุฌูุจ</h4>
                                    <ul v-if="currentTestResult.avoids.length > 0" class="text-sm text-slate-700 space-y-2 md:space-y-3 font-medium">
                                        <li v-for="tip in currentTestResult.avoids" class="flex items-start gap-2"><span class="text-red-500 mt-1">โข</span> {{ tip }}</li>
                                    </ul>
                                    <p v-else class="text-xs text-slate-400 italic">ูุง ุชูุฌุฏ ุชุญุฐูุฑุงุช ุฎุงุตุฉ.</p>
                                </div>
                            </div>

                            <div class="p-5 md:p-6 bg-slate-50 border-t border-slate-100">
                                <button @click="nextPhysicalTest" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-black shadow-lg flex justify-center items-center gap-2 transition-all active:scale-95">
                                    <span>ุญูุธ ูุงูุงูุชูุงู</span>
                                    <span>&larr;</span>
                                </button>
                            </div>
                        </div>
                    </transition>
                </div>
            </div>

            <div v-if="currentPhase === 'final'" class="max-w-5xl mx-auto printable-area bg-slate-50 p-0 animate-fade-in-up mb-20 relative">
                
                <div class="bg-slate-900 text-white p-6 md:p-12 rounded-b-[30px] md:rounded-b-[40px] shadow-2xl text-center relative overflow-hidden mb-8 md:mb-12">
                    <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-tr from-emerald-600/30 to-blue-600/30"></div>
                    <div class="relative z-10">
                        <h1 class="text-2xl md:text-4xl font-black mb-2 tracking-tight">ุชูุฑูุฑ ุงูุญุฑูุฉ</h1>
                        <p class="text-slate-400 text-sm md:text-lg font-light">ููุฎุต ุงูุชูุฌููุงุช ุงูุณููููุฉ</p>
                        <div class="mt-4 md:mt-6 inline-flex bg-white/10 backdrop-blur rounded-full px-4 py-1 md:px-6 md:py-2 text-[10px] md:text-sm">
                            <span class="text-emerald-300 font-bold ml-2">ุงููุณุชุฎุฏู:</span> {{ user.name }}
                        </div>
                    </div>
                </div>

                <div class="px-4 md:px-8 max-w-6xl mx-auto">
                    
                    <div class="text-center mb-8 md:mb-10">
                        <h2 class="text-xl md:text-3xl font-bold text-slate-800 inline-block border-b-4 border-emerald-500 pb-2">ุงููุงุฆูุฉ ุงูุฐูุจูุฉ</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-12 md:mb-16">
                        <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
                            <div class="bg-green-50 p-4 md:p-6 border-b border-green-100 flex items-center gap-3">
                                <div class="w-10 h-10 md:w-12 md:h-12 bg-green-500 rounded-2xl flex items-center justify-center text-white text-lg md:text-2xl shadow-lg">โ</div>
                                <div>
                                    <h3 class="text-lg md:text-xl font-bold text-green-900">ุงูููุทูุฉ ุงูุฎุถุฑุงุก</h3>
                                    <p class="text-[10px] md:text-xs text-green-600">ุงูุชุฒู ุจูุฐู ุงูุนุงุฏุงุช</p>
                                </div>
                            </div>
                            <div class="p-6 md:p-8">
                                <ul class="space-y-3 md:space-y-4">
                                    <li v-for="rec in finalDiagnosis.dos" class="flex items-start gap-3 md:gap-4 p-2 md:p-3 rounded-xl hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100">
                                        <div class="w-5 h-5 md:w-6 md:h-6 bg-green-100 rounded-full flex items-center justify-center shrink-0 mt-0.5 text-green-600 text-[10px] md:text-xs font-bold">โ</div>
                                        <span class="text-slate-700 text-sm md:text-base font-medium leading-relaxed">{{ rec }}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
                            <div class="bg-red-50 p-4 md:p-6 border-b border-red-100 flex items-center gap-3">
                                <div class="w-10 h-10 md:w-12 md:h-12 bg-red-500 rounded-2xl flex items-center justify-center text-white text-lg md:text-2xl shadow-lg">โ</div>
                                <div>
                                    <h3 class="text-lg md:text-xl font-bold text-red-900">ุงูููุทูุฉ ุงูุญูุฑุงุก</h3>
                                    <p class="text-[10px] md:text-xs text-red-600">ุชููู ุนู ูุฐู ุงูุญุฑูุงุช</p>
                                </div>
                            </div>
                            <div class="p-6 md:p-8">
                                <ul class="space-y-3 md:space-y-4">
                                    <li v-for="rec in finalDiagnosis.avoids" class="flex items-start gap-3 md:gap-4 p-2 md:p-3 rounded-xl hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100">
                                        <div class="w-5 h-5 md:w-6 md:h-6 bg-red-100 rounded-full flex items-center justify-center shrink-0 mt-0.5 text-red-600 text-[10px] md:text-xs font-bold">โ</div>
                                        <span class="text-slate-700 text-sm md:text-base font-medium leading-relaxed">{{ rec }}</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="mb-16 print-break hidden md:block">
                        <h3 class="text-xl font-black text-slate-800 mb-8 border-r-8 border-slate-800 pr-4">ุณุฌู ุงูููุงุญุธุงุช ุงูุชูุตููู</h3>
                        <div class="mb-8">
                            <h4 class="text-md font-bold text-slate-500 mb-4 uppercase tracking-widest flex items-center gap-2"><span>๐</span> ุฃููุงู: ุชุญููู ุงูุชุงุฑูุฎ ุงูุทุจู</h4>
                            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                                <div v-for="(item, i) in historyLog" :key="i" class="p-4 border-b border-slate-100 last:border-0 hover:bg-slate-50 transition-colors">
                                    <div class="flex justify-between items-start gap-4">
                                        <div class="text-sm font-bold text-slate-700 w-2/3">{{ item.q }}</div>
                                        <div class="text-sm font-medium text-blue-600 bg-blue-50 px-3 py-1 rounded-full text-center whitespace-nowrap">{{ item.a }}</div>
                                    </div>
                                    <div class="mt-2 text-xs text-slate-500 leading-relaxed bg-slate-50 p-2 rounded">{{ item.note }}</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-md font-bold text-slate-500 mb-4 uppercase tracking-widest flex items-center gap-2"><span>๐ช</span> ุซุงููุงู: ูุชุงุฆุฌ ุงููุญุต ุงูุฌุณุฏู</h4>
                            <div class="grid grid-cols-3 gap-4">
                                <div v-for="(test, i) in physicalLog" :key="i" :class="test.isPain ? 'border-red-200 bg-red-50/30' : 'border-slate-200 bg-white'" class="p-5 rounded-xl border shadow-sm hover:shadow-md transition-all flex flex-col justify-between h-full card-break">
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <div class="text-xs text-slate-400 font-bold uppercase">ุงุฎุชุจุงุฑ {{ i + 1 }}</div>
                                            <div class="text-xs font-bold px-2 py-1 rounded" :class="test.isPain ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'">
                                                {{ test.isPain ? 'ุฃูู' : 'ุณููู' }}
                                            </div>
                                        </div>
                                        <div class="font-bold text-slate-800 text-sm mb-2">{{ test.t }}</div>
                                        <div class="text-[10px] text-slate-500 leading-relaxed">{{ test.note.substring(0, 100) }}...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col gap-3 pb-24 buttons-container">
                        <button @click="toggleBig3" class="w-full py-4 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900 shadow-lg flex items-center justify-center gap-3 active:scale-95">
                            <span class="text-xl">๐๏ธ</span>
                            <span>ุชูุงุฑูู Big 3</span>
                        </button>
                        
                        <a href="https://www.youtube.com/watch?v=f7HLP96HVNM" target="_blank" class="w-full py-4 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 shadow-lg flex items-center justify-center gap-3 active:scale-95 no-underline">
                            <span class="text-xl">๐บ</span>
                            <span>ููุฏูู ุงูุจุฑูุงูุฌ</span>
                        </a>
                        
                        <button onclick="window.print()" class="w-full py-4 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 shadow-lg flex items-center justify-center gap-3 active:scale-95">
                            <span class="text-xl">๐จ๏ธ</span>
                            <span>ุญูุธ PDF</span>
                        </button>
                    </div>

                </div>
            </div>

        </div>
    </main>

    <button @click="toggleGuide" class="guide-btn fixed bottom-4 left-4 md:bottom-8 md:left-8 z-50 bg-blue-600 text-white w-12 h-12 md:w-auto md:h-auto md:px-6 md:py-4 rounded-full shadow-2xl hover:bg-blue-700 transition-all flex items-center justify-center md:gap-3 float-anim">
        <span class="text-2xl md:text-4xl">๐</span>
        <div class="text-right hidden md:block">
            <div class="text-xs font-light opacity-90">ูุณุงุนุฏุฉ</div>
            <div class="font-bold text-lg">ุฏููู ุงูุงุณุชุฎุฏุงู</div>
        </div>
    </button>

    <div v-if="showBig3" class="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-end md:items-center justify-center p-0 md:p-4" @click.self="toggleBig3">
        <div class="bg-white w-full max-w-4xl h-[85vh] md:h-auto rounded-t-[30px] md:rounded-[40px] p-6 md:p-10 shadow-2xl relative animate-fade-in-up overflow-y-auto">
            <button @click="toggleBig3" class="absolute top-4 right-4 bg-slate-100 rounded-full p-2 text-slate-500 hover:bg-slate-200 transition-colors">โ</button>
            <div class="text-center mb-6 md:mb-10 mt-4 md:mt-0">
                <h2 class="text-2xl md:text-4xl font-black text-slate-800 mb-2">Big 3</h2>
                <p class="text-emerald-600 font-medium text-sm md:text-base">ุงูุนููุฏ ุงูููุฑู ููุนูุงุฌ ุงููููุงูููู</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 pb-10">
                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-200 flex items-center md:block gap-4">
                    <div class="w-12 h-12 md:w-16 md:h-16 bg-white rounded-xl flex items-center justify-center text-2xl md:text-4xl shadow-sm shrink-0 md:mx-auto md:mb-4">๐ฆ</div>
                    <div>
                        <h3 class="font-bold text-lg text-slate-800">1. Curl-up</h3>
                        <p class="text-xs text-slate-500 leading-relaxed">ุชูุฑูู ุงูุจุทู ุงููุนุฏู.</p>
                    </div>
                </div>
                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-200 flex items-center md:block gap-4">
                    <div class="w-12 h-12 md:w-16 md:h-16 bg-white rounded-xl flex items-center justify-center text-2xl md:text-4xl shadow-sm shrink-0 md:mx-auto md:mb-4">๐ง</div>
                    <div>
                        <h3 class="font-bold text-lg text-slate-800">2. Side Plank</h3>
                        <p class="text-xs text-slate-500 leading-relaxed">ุงูุฌุณุฑ ุงูุฌุงูุจู.</p>
                    </div>
                </div>
                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-200 flex items-center md:block gap-4">
                    <div class="w-12 h-12 md:w-16 md:h-16 bg-white rounded-xl flex items-center justify-center text-2xl md:text-4xl shadow-sm shrink-0 md:mx-auto md:mb-4">๐</div>
                    <div>
                        <h3 class="font-bold text-lg text-slate-800">3. Bird Dog</h3>
                        <p class="text-xs text-slate-500 leading-relaxed">ูุถุนูุฉ ุงููุฏูู ูุงูุฑูุจุชูู.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showGuide" class="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-center justify-center p-2 md:p-4" @click.self="toggleGuide">
        <div class="bg-white w-full max-w-6xl h-[90vh] rounded-2xl md:rounded-[30px] shadow-2xl relative animate-fade-in-up border-4 border-blue-50 overflow-hidden flex flex-col">
            <div class="bg-slate-100 p-3 md:p-4 flex justify-between items-center border-b border-slate-200 shrink-0">
                <h2 class="text-base md:text-xl font-bold text-slate-700 flex items-center gap-2">
                    <span>๐</span> <span class="truncate">ุฏููู ุงููููุฏุณ</span>
                </h2>
                <button @click="toggleGuide" class="bg-white rounded-full p-1 md:p-2 text-slate-500 hover:bg-red-50 hover:text-red-500 transition-colors shadow-sm w-8 h-8 md:w-10 md:h-10 flex items-center justify-center font-bold">โ</button>
            </div>
            
            <div class="flex-1 bg-slate-50 relative overflow-y-auto">
                <iframe src="https://drive.google.com/file/d/1cHhVanZ4znX0z9OlyysKzvZHMw3eXZ6m/preview" class="w-full h-full min-h-[50vh]" frameborder="0">
                     <div class="flex flex-col items-center justify-center h-full p-10 text-center">
                        <p class="text-slate-500 mb-4">ุนุฑุถ PDF</p>
                        <a href="https://drive.google.com/file/d/1cHhVanZ4znX0z9OlyysKzvZHMw3eXZ6m/view?usp=sharing" target="_blank" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold">ุชุญููู ุงูุฏููู</a>
                    </div>
                </iframe>
            </div>

            <div class="bg-white p-3 md:p-4 border-t border-slate-200 text-center shrink-0">
                <a href="https://drive.google.com/file/d/1cHhVanZ4znX0z9OlyysKzvZHMw3eXZ6m/view?usp=sharing" target="_blank" class="inline-flex items-center gap-2 text-blue-600 font-bold hover:underline text-sm md:text-base">
                    <span>๐ฅ</span> ุชุญููู PDF
                </a>
            </div>
        </div>
    </div>

</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            currentPhase: 'intro',
            historyIndex: -1, 
            physicalIndex: 0,
            user: { name: '', age: '' },
            disclaimerAccepted: false,
            mobileLogOpen: false, // New state for mobile sidebar
            evidenceLog: [],
            historyLog: [],   
            physicalLog: [],  
            lastAnswerNote: null,
            currentTestResult: null,
            showBig3: false,
            showGuide: false, 
            
            // Accumulated lists
            globalDos: [],
            globalAvoids: [],

            // === 1. HISTORY QUESTIONS ===
            historyQuestions: [
                { 
                    id: 'q1', 
                    text: '1. ูู ุชุชุบูุฑ ุญุฏุฉ ุงูุฃูู ุฎูุงู ุงููููุ', 
                    options: [ 
                        { label: 'ูุนูุ ูุชุบูุฑ ูุชูุฌุฏ ูุชุฑุงุช ุฑุงุญุฉ', trigger: 'Mechanical Pain', note: 'ุฅุฐุง ูุงู ุฃููู ูุชุบูุฑุ ูููุงู ุณุจุจ ูุญุฏุฏ (ูุถุนูุฉ ุฃู ุญุฑูุฉ). ููู ุงูุณุจุจ ูู ุงูููุชุงุญ.' }, 
                        { label: 'ูุงุ ุงูุฃูู ุซุงุจุช 24 ุณุงุนุฉ', trigger: 'Non-Mechanical', note: 'ุงูุฃูู ุงูุซุงุจุช ูุฏ ูุดูุฑ ูุณุจุจ ุบูุฑ ูููุงูููู. ููุตุญ ุจุฒูุงุฑุฉ ุทุจูุจ.' } 
                    ] 
                },
                { 
                    id: 'q2', 
                    text: '2. ุนูุฏ ุงูุชููุจ ูู ุงูุณุฑูุฑุ ูู ุชูุงุฌู "ูุบุฒุงุช" ูุคููุฉุ', 
                    options: [ 
                        { label: 'ูุนูุ ูุบุฒุงุช ุญุงุฏุฉ', trigger: 'Spinal Instability', note: 'ูุฏ ุชุนุงูู ูู ุนุฏู ุงุณุชูุฑุงุฑ ุงูุนููุฏ ุงูููุฑู. ุงูุญู ูู "ุชุตูุจ" ุงูุนุถูุงุช (Bracing) ูุชุฌูุจ ุงูุฅุทุงูุฉ.' }, 
                        { label: 'ูุง', trigger: null, note: 'ูุคุดุฑ ุฌูุฏ ุนูู ุซุจุงุช ุงูููุงุตู.' } 
                    ] 
                },
                { 
                    id: 'q3', 
                    text: '3. ูุง ุงูุฐู ูุฌุนู ุฃููู ุฃุณูุฃุ', 
                    options: [ 
                        { label: 'ูุดุงุท ูุญุฏุฏ (ุฑูุงุถุฉ/ุญุฑูุฉ)', trigger: 'Specific Trigger', note: 'ูุฏูู "ูุญูุฒ" ููุฃูู. ุนููู ุชุนุฏูู ุทุฑููุฉ ุฃุฏุงุกู ููุฐุง ุงููุดุงุท.' }, 
                        { label: 'ุงูุฃูู ุนุดูุงุฆู', trigger: null, note: 'ุฑุงูุจ ุญุฑูุงุชู ุงูููููุฉ ุจุฏูุฉ ุฃูุจุฑ ููุนุซูุฑ ุนูู ุงููุญูุฒ ุงูุฎูู.' } 
                    ] 
                },
                { 
                    id: 'q4', 
                    text: '4. ููู ุจุฏุฃ ุงูุฃููุ', 
                    options: [ 
                        { label: 'ุญุงุฏุซ / ุณููุท', trigger: 'Traumatic Origin', note: 'ุงูุฃูุณุฌุฉ ุชุถุฑุฑุชุ ููู ูุถุนูุงุช ุงูุฑุงุญุฉ ุชุณุงุนุฏ ุนูู ุงูุดูุงุก.' }, 
                        { label: 'ุธูุฑ ุจุจุทุก ูุชุฒุงูุฏ', trigger: 'Cumulative Load', note: 'ูุฐุง "ุญูู ุชุฑุงููู". ุนุงุฏุงุชู ุงูููููุฉ ุชุฑุงููุช ุญุชู ุชุฌุงูุฒุช ุญุฏ ุงูุชุญูู.' } 
                    ] 
                },
                { 
                    id: 'q5', 
                    text: '5. ูู ูุฏูู ุชุงุฑูุฎ ูุน ูุดุงุดุฉ ุงูุนุธุงูุ', 
                    options: [ 
                        { label: 'ูุนู', trigger: 'Bone Fragility', note: 'ุชุฌูุจ ุชูุงุฑูู ุงูุงูุญูุงุก ูุชูุงุฑูู ุงูุถุบุท ุงูุนุงูู.' }, 
                        { label: 'ูุง', trigger: null, note: 'ุฌูุฏ.' } 
                    ] 
                },
                { 
                    id: 'q6', 
                    text: '6. ูู ุงูุฃูู ุฃุณูุฃ ููุฑ ุงูุงุณุชููุงุธุ', 
                    options: [ 
                        { label: 'ูุนูุ ุฃุณูุฃ ูู ุงูุตุจุงุญ', trigger: 'Bed/Sleep Issue', note: 'ูุฏ ุชููู ุงููุฑุชุจุฉ ูู ุงูุณุจุจุ ุฃู ูุถุนูุฉ ูููู.' }, 
                        { label: 'ูุงุ ูุฒุฏุงุฏ ูุงุญูุงู', trigger: null, note: 'ุงููุดููุฉ ูู ูุดุงุทุงุชู ุงูููุงุฑูุฉ.' } 
                    ] 
                },
                { 
                    id: 'q7', 
                    text: '7. ูู ูุฒุฏุงุฏ ุงูุฃูู ุชุฏุฑูุฌูุงู ูุน ูุฑูุฑ ุงููููุ', 
                    options: [ 
                        { label: 'ูุนูุ ูุฒุฏุงุฏ', trigger: 'Cumulative Loading', note: 'ุชุญุชุงุฌ ููุชุฑุงุช ุฑุงุญุฉ ูุตูุฑุฉ ูุชูุฑุฑุฉ ูุชูุณูู ุงูููู.' }, 
                        { label: 'ูุง', trigger: null, note: 'ุงูุฃูู ูุฑุชุจุท ุจุญุฑูุงุช ูุญุฏุฏุฉ.' } 
                    ] 
                },
                { 
                    id: 'q8', 
                    text: '8. ูู ุงูุฃูู ูู ููุชุตู ุงูุธูุฑุ', 
                    options: [ 
                        { label: 'ูุนูุ ูู ุงูููุชุตู', trigger: 'Thoracolumbar Hinge', note: 'ุฃูุช "ุชูุณุฑ" ุธูุฑู ูู ุงูููุชุตู. ุชุนูู ุงูุญุฑูุฉ ูู ุงููุฑู.' }, 
                        { label: 'ูุงุ ุฃุณูู ุงูุธูุฑ', trigger: null, note: 'ุดุงุฆุน ููุฑุชุจุท ุจุงูุฏูุณู ุฃู ุงูููุงุตู.' } 
                    ] 
                },
                { 
                    id: 'q9', 
                    text: '9. ูู ููุชุฏ ุงูุฃูู ููุณุงูููุ', 
                    options: [ 
                        { label: 'ูุนูุ ููุชุฏ ููุณุงู', trigger: 'Nerve Root Tension', note: 'ุนุฑู ุงููุณุง (Sciatica). ุชุฌูุจ ุงูุญูุงุก ุงูุธูุฑ ูุชูููู ุงูุถุบุท ุนูู ุงูุนุตุจ.' }, 
                        { label: 'ูุงุ ูู ุงูุธูุฑ ููุท', trigger: null, note: 'ูุคุดุฑ ุฌูุฏุ ุงูุนุตุจ ุณููู.' } 
                    ] 
                },
                { 
                    id: 'q10', 
                    text: '10. ุชุฃุซูุฑ ุงููุดู ุงูุณุฑูุนุ', 
                    options: [ 
                        { label: 'ูููู ุงูุฃูู', trigger: 'Disc Responder', note: 'ุงููุดู ุงูุณุฑูุน ุนูุงุฌ ูู. ุชุฌูุจ ุงููุดู ุงูุจุทูุก.' }, 
                        { label: 'ูุฒูุฏ ุงูุฃูู', trigger: 'Stenosis Responder', note: 'ูุฏ ูููู ุชุถูู ุงูููุงุฉ. ุงูุดู ููุชุฑุงุช ูุตูุฑุฉ ุฌุฏุงู.' } 
                    ] 
                }
            ],

            // === 2. PHYSICAL TESTS ===
            physicalTests: [
                { 
                    id: 't1', title: '1. ุถุบุท ุงููุฑุณู', image: 'img/test1.png', 
                    instruction: `<ul><li>ุงุฌูุณ ูุฃูุณู ุงูููุนุฏ.</li><li><strong>1. ูุณุชููู:</strong> ุงุณุญุจ ููุฃุนูู.</li><li><strong>2. ูุชุฑุงุฎู:</strong> ุงุฑุฎู ุธูุฑู ูุงุณุญุจ.</li></ul>`, 
                    question: 'ุฃูู ุงูุฃููุ', 
                    options: [ 
                        { 
                            label: 'ุงููุชุฑุงุฎู (Slouched)', diagnosis: 'Flexion Intolerance', 
                            feedback: 'ุฃูุช ูุง ุชุชุญูู ุงูุงูุญูุงุก (ุฏูุณู).', 
                            dos: ['ุญุงูุธ ุนูู ุงุณุชูุงูุฉ ุธูุฑู ุฏุงุฆูุงู', 'ุชูุงุฑูู Big 3'], 
                            avoids: ['ุงูุฌููุณ ุงููุชุฑุงุฎู', 'ููุณ ุงูุฃุตุงุจุน'] 
                        }, 
                        { 
                            label: 'ุงููุณุชููู (Tall)', diagnosis: 'Compression Intolerance', 
                            feedback: 'ุฃูู ุถุบุท. ููุฑุงุชู ุญุณุงุณุฉ.', 
                            dos: ['ููู ุงูุฃุญูุงู', 'ุชุตูุจ ุงูุฌุฐุน'], 
                            avoids: ['ุญูู ุงูุฃูุฒุงู', 'ุงูููุฒ'] 
                        }, 
                        { label: 'ูุง ุฃูู', diagnosis: null, feedback: 'ููุชุงุฒ.', dos: [], avoids: [] } 
                    ] 
                },
                {
                    id: 't2', title: '2. ุตุฏูุฉ ุงููุนุจ', image: 'img/test2.png',
                    instruction: `<ul><li>ููุ ุงุฑุชูุน ุนูู ุฃุตุงุจุนูุ ุงุณูุท ุนูู ูุนุจูู ุจููุฉ.</li></ul>`,
                    question: 'ุงูููุงุญุธุฉุ',
                    options: [
                        { 
                            label: 'ุฃูู (ุฎุงุตุฉ ุนูุฏ ุงููุธุฑ ูุฃุณูู)', diagnosis: 'Nerve Tension', 
                            feedback: 'ุชูุชุฑ ูู ุงูุนุตุจ.', 
                            dos: ['ูุถุนูุฉ ุฑูุจุฉ ูุฑูุญุฉ'], 
                            avoids: ['ุชูุงุฑูู ุงูุฅุทุงูุฉ'] 
                        },
                        { 
                            label: 'ุงูุณููุท ูุคูู ุฏุงุฆูุงู', diagnosis: 'Load Intolerance', 
                            feedback: 'ุญุณุงุณูุฉ ููุตุฏูุงุช.', 
                            dos: ['ุฃุญุฐูุฉ ูุฑูุญุฉ'], 
                            avoids: ['ุงูุฌุฑู', 'ุงูุฃุณุทุญ ุงูุตูุจุฉ'] 
                        },
                        { label: 'ูุง ุฃูู', diagnosis: null, feedback: 'ุฌูุฏ.', dos: [], avoids: [] }
                    ]
                },
                {
                    id: 't3', title: '3. ุงูุงุณุชููุงุก (Tummy Lie)', image: 'img/test3.png',
                    instruction: `<ul><li>ุงุณุชููู ุนูู ุจุทูู 3 ุฏูุงุฆู.</li></ul>`,
                    question: 'ุงูุดุนูุฑุ',
                    options: [
                        { 
                            label: 'ุงูุฃูู ุฎู', diagnosis: 'Disc Bulge Responder', 
                            feedback: 'ุงูุงูุญูุงุก ุนุฏููุ ูุงูุชูุฏุฏ ุนูุงุฌู.', 
                            dos: ['ุงุณุชููู ููุฐุง ุนูุฏ ุงูุฃูู', 'ุงููุดู'], 
                            avoids: ['ุงูุฌููุณ ุงูุทููู'] 
                        },
                        { 
                            label: 'ุงูุฃูู ุฒุงุฏ', diagnosis: 'Extension Intolerance', 
                            feedback: 'ูุง ุชุชุญูู ุงูุชูุฏุฏ ููุฎูู.', 
                            dos: ['ูุณุงุฏุฉ ุชุญุช ุงูุจุทู ุนูุฏ ุงูููู'], 
                            avoids: ['ุชูุฑูู ุงูููุจุฑุง'] 
                        }
                    ]
                },
                {
                    id: 't4', title: '4. ุงูุชูุฏุฏ ูุงูุฏูุฑุงู', image: 'img/test4.png',
                    instruction: `<ul><li>ููุ ููุณ ุธูุฑู ููุฎูู ููููุงู ููู ููููุงู ููุณุงุฑุงู.</li></ul>`,
                    question: 'ุงููุชูุฌุฉ:',
                    options: [
                        { 
                            label: 'ุฃูู ุนูุฏ ุงูุฏูุฑุงู', diagnosis: 'Facet Joint Pathology', 
                            feedback: 'ูุดููุฉ ููุงุตู ุฎูููุฉ.', 
                            dos: ['ุฏุฑ ุจุฌุณูู ูุงููุงู'], 
                            avoids: ['ุงููุชู (Twisting)'] 
                        },
                        { label: 'ูุง ุฃูู', diagnosis: null, feedback: 'ุณููู.', dos: [], avoids: [] }
                    ]
                },
                {
                    id: 't5', title: '5. ุจูุงูู ุงูุฌุฏุงุฑ', image: 'img/test5.png',
                    instruction: `<ul><li>ุงุณุชูุฏ ุจูุฑูููู ุนูู ุงูุฌุฏุงุฑ. ุงุจุญุซ ุนู ูุถุนูุฉ ูุฑูุญุฉ ูุธูุฑู.</li></ul>`,
                    question: 'ูู ูุฌุฏุช ุฑุงุญุฉุ',
                    options: [
                        { 
                            label: 'ูุนู', diagnosis: 'Postural Responder', 
                            feedback: 'ุฃููู ูููุงูููู ูุนูุงุฌู ุงููุถุนูุฉ ุงูุตุญูุญุฉ.', 
                            dos: ['ุงุญูุธ ูุฐู ุงููุถุนูุฉ'], 
                            avoids: ['ุงูุซุจุงุช ุงูุทููู'] 
                        },
                        { 
                            label: 'ูุง', diagnosis: 'High Sensitivity', 
                            feedback: 'ุฃูุณุฌุชู ูุชููุฌุฉ.', 
                            dos: ['ุงูุฑุงุญุฉ ุงููุชูุฑุฑุฉ'], 
                            avoids: ['ุงูุชูุงุฑูู ุงูุนูููุฉ'] 
                        }
                    ]
                },
                {
                    id: 't6', title: '6. ุญูู ุงููุฒู', image: 'img/test6.png',
                    instruction: `<ul><li>ุงุญูู ูุฒูุงู ุฎูููุงู ููุฏ ูุฏู. ูู ูุคููุ ุดุฏ ุจุทูู. ูู ุงุฎุชููุ</li></ul>`,
                    question: 'ุงูุชุฃุซูุฑุ',
                    options: [
                        { 
                            label: 'ูุคูู ุจุนูุฏุงู ุนู ุงูุฌุณู', diagnosis: 'Load Intolerance', 
                            feedback: 'ูุง ุชุชุญูู ุงูุญูู ุงูุจุนูุฏ.', 
                            dos: ['ุงุญูู ุงูุฃุดูุงุก ูุฑูุจุฉ ููู'], 
                            avoids: ['ูุฏ ุงููุฏ ููุฃุดูุงุก'] 
                        },
                        { 
                            label: 'ุงูุดุฏ ููุน ุงูุฃูู', diagnosis: 'Stabilization Responder', 
                            feedback: 'ุนุถูุงุชู ุชุญููู.', 
                            dos: ['ุดุฏ ุจุทูู ูุจู ุงูุญุฑูุฉ'], 
                            avoids: ['ุงูุงุณุชุฑุฎุงุก ุนูุฏ ุงูุญูู'] 
                        }
                    ]
                }
            ]
        }
    },
    computed: {
        currentHistoryQ() { return this.historyQuestions[this.historyIndex]; },
        currentPhysicalTest() { return this.physicalTests[this.physicalIndex]; },
        progress() {
            const totalSteps = 1 + this.historyQuestions.length + this.physicalTests.length;
            let current = 0;
            if(this.currentPhase === 'intro') current = 0;
            else if(this.currentPhase === 'history') current = 1 + (this.historyIndex > -1 ? this.historyIndex : 0);
            else if(this.currentPhase === 'physical') current = 1 + this.historyQuestions.length + this.physicalIndex;
            else current = totalSteps;
            return (current / totalSteps) * 100;
        },
        finalDiagnosis() {
            let flexCount = this.evidenceLog.filter(e => e.type.includes('Flexion') || e.type.includes('Disc')).length;
            let extCount = this.evidenceLog.filter(e => e.type.includes('Extension') || e.type.includes('Facet')).length;
            let nerveCount = this.evidenceLog.filter(e => e.type.includes('Nerve') || e.type.includes('Tension')).length;
            let loadCount = this.evidenceLog.filter(e => e.type.includes('Load') || e.type.includes('Compression')).length;

            let dos = ["ุงููุดู ุงููุชูุทุน", "ุชุตูุจ ุงูุฌุฐุน (Big 3)", "ููู ุจูุถุน ูุญุงูุฏ"];
            let avoids = ["ุงูุฌููุณ/ุงููููู ุงูุทููู"];

            if (flexCount >= 1 && flexCount >= extCount) {
                dos.push("ุงูุงุณุชููุงุก ุนูู ุงูุจุทู ููุฑุงุญุฉ", "Hip Hinge");
                avoids.push("ุงูุฌููุณ ุจุธูุฑ ููุญูู", "ููุณ ุงูุฃุตุงุจุน", "ุชูุงุฑูู ุงูุจุทู");
            } 
            if (extCount >= 1) {
                dos.push("ุซูู ุงูุธูุฑ ููููุงู ููููุงู");
                avoids.push("ุงูููุจุฑุง (Yoga)", "ุงูููู ุนูู ุงูุจุทู");
            }
            if (nerveCount > 0) {
                avoids.push("ุชูุงุฑูู ุงูุฅุทุงูุฉ (Stretching)");
            }
            if (loadCount > 0) {
                avoids.push("ุญูู ุงูุฃูุฒุงู", "ุงูุฌุฑู");
            }

            return { dos: [...new Set(dos)], avoids: [...new Set(avoids)] };
        }
    },
    methods: {
        startApp() { this.currentPhase = 'history'; },
        toggleBig3() { this.showBig3 = !this.showBig3; },
        toggleGuide() { this.showGuide = !this.showGuide; },
        handleHistoryAnswer(option) {
            if (option.trigger) {
                this.evidenceLog.push({ source: 'ุชุงุฑูุฎ', type: option.trigger, note: option.note });
            }
            this.historyLog.push({ q: this.currentHistoryQ.text, a: option.label, note: option.note });
            this.lastAnswerNote = option.note;
        },
        nextHistoryQuestion() {
            this.lastAnswerNote = null;
            if (this.historyIndex < this.historyQuestions.length - 1) {
                this.historyIndex++;
            } else {
                this.currentPhase = 'physical';
            }
        },
        handlePhysicalAnswer(option) {
            const dos = option.dos ? option.dos : [];
            const avoids = option.avoids ? option.avoids : [];
            this.currentTestResult = { diagnosis: option.diagnosis, feedback: option.feedback, dos, avoids };
            this.physicalLog.push({ t: this.currentPhysicalTest.title, r: option.label, isPain: option.diagnosis !== null, note: option.feedback });
            if (option.diagnosis) {
                this.evidenceLog.push({ source: `Test ${this.physicalIndex + 1}`, type: option.diagnosis, note: option.feedback });
            }
            if (dos.length > 0) this.globalDos.push(...dos);
            if (avoids.length > 0) this.globalAvoids.push(...avoids);
        },
        nextPhysicalTest() {
            this.currentTestResult = null;
            if (this.physicalIndex < this.physicalTests.length - 1) {
                this.physicalIndex++;
            } else {
                this.currentPhase = 'final';
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        }
    }
}).mount('#app');
</script>

</body>
</html>
